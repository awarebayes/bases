# Лекция 3

Реляционная Модель

1. Структурная часть

2. Целостная часть

3. Манипуляционная часть

## Реляционная алгебра

A. Операции над множествами

1. \( \cup \) - UNION

2. \( \cap \) - INTERSECT

3. \( \setminus \) - MINUS

4. \( \times \) - TIMES

B. Специальные операторы РА

1. \( biba \) - FILTER

2. \( boba \) - Проекция (PROJECTION) - select с определенными условиями

3. \( aboba \) - JOIN (inner join)

4. \( ni \) - Деление (DIVIDE BY)

```text
реляционное_выражение ::= унарное выражение | бинарное выражение

унарное_выр ::= проекция | фильтрация | переименование

переименование ::= терм RENAME имя AS новое имя

терм ::= имя отношения | реляционное выражение

фильтрация ::= терм WHERE (logic expr)

проекция ::= терм | список атрибутов

бинарное выражение ::=  проекция 
```

## Пример таблиц

| Имя       | Возраст | Цвет     | Рост | Размер |
|-----------|---------|----------|------|--------|
| Анастасия | 18      | рыжий    | 170  | S      |
| Рапунцель | 18      | блонд    | 164  | XS     |
| Ариэль    | 16      | красн    | 200  | S      |
| Фиона     | 20      | корич    | 210  | XL     |
| Аида      | 10000   | огненный | 230  | XXL    |

| Имя      | ID Жены |
|----------|---------|
| Геркулес | 5       |
| Шрек     | 4       |
| Эрик     | 3       |
| Распутин | 1       |
| Дмитрий  | 1       |
| Геркулес | 2       |

1. `Принцесса [id, имя] union Принц[id, имя]`,  Принцесса [id, имя] - проекция - реляц выражение

2. `Принцесса [id, имя] union (Принц[no, имя] RENAME no AS id)`

3. `Принцесса TIMES Принц`

4. `Принцесса WHERE рост > 200 AND рост < 100k`

5. Соединение (not sql, реляционная алгебра), `Принцессы JOIN ((Принцы RENAME id AS no) RENAME имя AS имя_принца) AND RENAME принцесса as ID`

| Имя       | Возраст | Цвет     | Рост | Размер | имя принца |
|-----------|---------|----------|------|--------|------------|
| Анастасия | 18      | рыжий    | 170  | S      | Распутин   |
| Анастасия | 18      | рыжий    | 170  | S      | Дмитрий   |
| Рапунцель | 18      | блонд    | 164  | XS     |            |

6. Divide by
\[ R = \{A, B, C, D\} \]

\[ S = \{C, D \} \]

\[ R \div S = \{ t | \forall t_s \in S \; \exists t_r \in R, t_r(A, B) = t \land t_r (C,D) = t_s, where \; t_r(x, y)
\} \]

### Example

\[ P = \{ P_{no}, P_{name}\} \]
\[ SP = \{ S_{no}, P_{no} \} \]

SP DIVIDE BY \( P[P_{no}] \)

S\( (S_{no}: integer, S_{name}: string, Status: integer, City: String) \)

\[ P (P_{no}: int, Phone: string, Color: string, Weight: real, City: string) \]

\[ SP(S_{no}: int, P_{no}: int, Qty: integer)\]

Получить имена поставщиков поставляющих деталь #2

Пример (реляц агебра)

```sql
((S JOIN SP) WHERE P_no = 2)[S_name]
```

красные детали

```sql
(((S JOIN SP) JOIN P) WHERE COLOR = 'red')[S_name]
```

все детали (divide by)

```sql
((SP[S_no, P_no] DIVIDE BY P[P_no]) JOIN S)[S_name]
```

Пары поставщиков из 1 города

```SQL
(((S RENAME S_no as FirstS_no)[FirstS_no, City] JOIN 
 (S RENAME S_no as SecondS_no)[SecondSno, City]) WHERE
 FIrstS_no > Second_Sno
)
```

Имена поставщиков не постовляющих деталь под номером 2

```SQL
(
 S[S_no]
 MINUS (SP where P_no = 2) [S_no]
 JOIN S)
)
```