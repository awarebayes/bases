# Лекция 5

Исчесление кортежей

$$ \forall \; \& \; \exists $$

Кортежи - начинаем с переменных - range of
Рел алгебра - выражение запрос
поставщики P - S - детали S

## Объявление переменной

Range of SX is S where 

## Пишем выражение

 `(SX.Sname) where SX.City = "Смоленск" and SX.Status > 20`

## Задачка 1

Поставляют красную деталь хотя бы одну

```sql
range of sx is s
range of PX is P
range of SPX is SP
(SX.Sname) where exists SPX (
    SPX.SNo = SX.Sno and exists PX (
        PX.Pno = SPX.Pno and PX.Color = "красный"
    )
)
```

## Задачка 2

Пара поставщиков, два в одном городе

```sql
range of sx is S
range of sy is S
(SX.Sno, Sy.Sno) where SX.City = Sy.City and SX.Sno > Sy.Sno
```

## Задачка 3

Имена поставщиков которые поставляют все детали

```sql
range of sx is S
range of SPX is SP

(SX) where for all PX (
    exists SPX (
        SPX.Pno = PX.Pno and SPX.Sno = Sx.Sno
    )
)
```

```sql
SX.Sname where not exists SPX (
    SPX.Sno = SX.Pno and SPX.Pno = 2
)
```

## Задачка 4

Получить общее кол во поставляемых деталей. Приер использования аггрегатной функции

```sql
SUM (SPX, Qty) as total
--   ^^^   ^--- аттрибуты
-- выражение

```

## Задачка 5

Номер поставщика и кол-во поставляемых деталей

```sql
(SX.Sno, count(SPX where SPX.Sno = SX.Sno))
```

## Задачка 6

Города в которых хранится более 5 красных деталей

```sql
PX.City where count (
    PY where PY.Pno = PX.Pno and PY.Color == "красный"
) > 5
-- PY - другая перменная
```

## Исчисление доменов

Скалярная переменная - столбец
Отличается синтаксисом, есть завязка на отношения

# Функциональные зависимостии

| Sno      | City | Pno | Qty (Quantity)|
|----------|------|-----|---------------|
| Смоленск |  1   | 100 | 100           |
| Смоленск |  2   | 100 | 100           |
| Владимир |  1   | 100 | 200           |
| Владимир |  2   | 100 | 300           |
| Смоленск |  3   | 100 | 400           |
| Смоленск |  4   | 100 | 400           |
| Смоленск |  5   | 100 | 400           |

Пусть R - отношение
x,y - произвольные подмножества множества аттрибутов

$$ X \mapsto Y $$

Функция - отображение

В терминах баз данных - логическая связь между несколькими аттрибутами.

Связи - временные и постоянные.
Постоянные для доменов.

$$ \{S_{no} \} \mapsto \{City\} $$
$$ \{ S_{no}, P_{no} \} \mapsto \{City\} $$
$$ \{ S_{no}, P_{no} \} \mapsto \{City, City\} $$
$$ \{ S_{no}, P_{no} \} \mapsto \{P_{no}\} $$

Пусть R - отношение
x,y - произвольные подмножества множества аттрибутов

$$ X \mapsto Y \iff $$
любое значение множества x связано в точности с одним значением y

X - детерминант
Y - зависимая часть

## Аномалии

### Insert

Вставляем сущность в данные, эта вставка ведет к вставке другой сущности

Решение:

\[ \{ S_{no}, City \}\]
\[ \{ S_{Pno}, P_{no}, Qty \}\]

### Delete

Удаляем из одной таблицы, но не удаляем из другой

### Update

(?) Одно обновляем другое нет

Ф.З. помогают бороться с аномалией

Ф.З. Тривиальная если Y включен в X
$$ \{ S_{no}, P_{no} \} \mapsto \{P_{no}\} $$

### Замыкание

S - множество ф.з.

Это перебор всех зависимостей которые можно вывести из S

\( S ^ +\) - множество всех ф.з. которые задаются S

Нет оптимального алгоритма

### 3 правила Армстронга

Нужны для выявления ф.з.

#### Рефлексивность

$$ B \in A \implies A \mapsto B $$

#### Дополнение

$$ A \mapsto B \implies AC \mapsto BC $$

#### Транзитивность

$$ A \mapsto B, \; B \mapsto C \implies A \mapsto C $$

### Дополнительные правила

#### Самооопределение

$$ A \mapsto A $$

#### Декомпозиция

$$ A \mapsto BC \implies A \mapsto B, \; A \mapsto C $$

#### Объединение

$$ A \mapsto B, \; A \mapsto C \implies A  \mapsto BC$$

#### Композиция

$$ A \mapsto B,\; C \mapsto D \implies AC \mapsto BD $$

### Теорема объединения

$$ A \mapsto B, C \mapsto D \implies A (C - B) \mapsto BD$$

## Задачка 7

R(A,B,C,D,E,F) - переменная отношения

R - таблица
A-F - стобцы

$$ S = \{A \mapsto BC, B \mapsto E, CD \mapsto EF \} $$

\( AD \mapsto F \) ????

1) \(CD \mapsto EF \implies CD \mapsto F, \; CD \mapsto F\), 5
2) \( A \mapsto BC \implies A \mapsto B, \; A \mapsto C \), 5
3) \( AD \mapsto CD \), 2
4) \( AD \mapsto CD, \; CD \mapsto F \implies AD \mapsto F \), 3

### Суперключ

Множество аттрибутов переменной отношения, которое содержит в виде подмножества по крайней мере один потенциальный ключ

Потенциальный ключ - неизбыточность + уникальность
Первичный ключ - выбранный ручками потенциальный ключ

Из этого набора выводимы все значениями
Ф.з. выше это попытка понять - можно ли из A, D однозначно вывести F

\[ \{A, D\} ^ + \]

Что делать????

Создаем таблички. В строках - S

|      |A, D | A,B,C,D,E,F |
|------|-----|-------------|
| \(A \mapsto BC \) | A, B, C, D| -.- |
|\( B \mapsto E \)|A,B,C,D,E| -.- |
| \( CD \mapsto EF \) | A,B,C,D,E | -.- |

#### Задачка 8

\( R(A, B,C,D,E,F) \)


\[ S = \{A \mapsto BC, E \mapsto CD, B \mapsto E, CD \mapsto EF \} \]

Это множество - ключ? \( \{A, B\}^+ \) - нет, где то в правой нет

Это множество - ключ? \( \{A, B, C, D, E, F\}^+ \) - суперключ, минимизируем его

Это множество - ключ? \( \{A, B, C, D, E\}^+ \) - суперключ, он содержит A и содежит D, а в прошлом получили A,D - суперключ

\( \{ A, D \} ^ + \) - потенциальный ключ

